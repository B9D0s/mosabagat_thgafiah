<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <title>البرنامج التحفيزي</title>
    <style>
        body {
            background: #f6f7fb;
            font-family: "Tahoma", Arial;
            margin: 0;
        }

        header {
            background: #1f4c8e;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            cursor: text;
        }

        header small {
            display: block;
            font-size: 12px;
            color: #dcdcdc;
            margin-top: 5px;
        }

        .container {
            width: 90%;
            margin: auto;
            margin-top: 20px;
        }

        section {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, .1);
        }

        h2 {
            margin-top: 0;
            color: #333;
        }

        input,
        select,
        button {
            padding: 8px;
            margin: 5px;
        }

        button {
            cursor: pointer;
            border: none;
            border-radius: 5px;
        }

        .addBtn {
            background: #27ae60;
            color: white;
        }

        .resetAll {
            background: #d63031;
            color: white;
        }

        .deductBtn {
            background: #0984e3;
            color: white;
        }

        .studentCard {
            background: #ffffff;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, .1);
            display: inline-block;
            width: 220px;
            vertical-align: top;
            margin: 7px;
            text-align: center;
        }

        .studentCard img {
            width: 100%;
            height: 150px;
            border-radius: 8px;
            object-fit: cover;
            background: #eee;
        }

        .name {
            font-size: 18px;
            font-weight: bold;
        }

        .points {
            margin-top: 5px;
        }

        .low {
            background: #ffe5e5;
        }

        .historyBox {
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>

<body>

    <header id="programTitle" contenteditable="true">
        برنامج السلطان
        <small>(اضغط هنا لتعديل الاسم)</small>
    </header>

    <div class="container">

        <section>
            <h2>إدخال بيانات الطلاب</h2>
            <input id="nameInput" placeholder="اسم الطالب">
            <input id="pointsInput" type="number" placeholder="مجموع النقاط">
            <input id="imgInput" type="file" accept="image/*">
            <button class="addBtn" onclick="addStudent()">إضافة طالب</button>
            <button class="resetAll" onclick="resetAll()">إعادة تعيين جميع الطلاب</button>
        </section>

        <section>
            <h2>قائمة الطلاب</h2>
            <div id="studentsList"></div>
        </section>

        <section>
            <h2>المزاد وخصم النقاط</h2>
            <select id="studentSelect"></select>
            <input id="deductInput" type="number" placeholder="قيمة الخصم">
            <button class="deductBtn" onclick="deductPoints()">خصم النقاط</button>
        </section>

        <section>
            <h2>سجل العمليات</h2>
            <div class="historyBox" id="history"></div>
        </section>

    </div>

    <script>
        // ==========================
        // إعدادات عامة
        // ==========================

        // إذا تريد ضرب النقاط في 10 مثلاً 100 → 1000
        // غيّر القيمة هنا
        const POINTS_MULTIPLIER = 1;

        // الطلاب - بيانات طلاب السلطان
        let students = [
            { id: 1, name: "عبدالله الصبيح", total: 6380, current: 6380, spent: 0, img: "" },
            { id: 2, name: "حسين باقعيش", total: 6150, current: 6150, spent: 0, img: "" },
            { id: 3, name: "المثنى العواد", total: 6030, current: 6030, spent: 0, img: "" },
            { id: 4, name: "عبد المجيد الرقيم", total: 5340, current: 5340, spent: 0, img: "" },
            { id: 5, name: "انس عبد الإله العجلان", total: 5330, current: 5330, spent: 0, img: "" },
            { id: 6, name: "نواف المحيميد", total: 5270, current: 5270, spent: 0, img: "" },
            { id: 7, name: "علي السحيباني", total: 4910, current: 4910, spent: 0, img: "" },
            { id: 8, name: "عبد الرحمن عبد العزيز الصبيحي", total: 4560, current: 4560, spent: 0, img: "" },
            { id: 9, name: "عبد العزيز الضويحي", total: 4440, current: 4440, spent: 0, img: "" },
            { id: 10, name: "فهد عبد الرزاق الدويش", total: 3980, current: 3980, spent: 0, img: "" },
            { id: 11, name: "عبد الرحمن النتيفات", total: 3700, current: 3700, spent: 0, img: "" },
            { id: 12, name: "مهيدب خالد المهيدب", total: 3680, current: 3680, spent: 0, img: "" },
            { id: 13, name: "عبد العزيز محمد الدهاسي", total: 3580, current: 3580, spent: 0, img: "" },
            { id: 14, name: "عبد اللطيف إبراهيم المناع", total: 3560, current: 3560, spent: 0, img: "" },
            { id: 15, name: "ابراهيم العوشن", total: 3550, current: 3550, spent: 0, img: "" },
            { id: 16, name: "سعد عاصم الجريد", total: 3550, current: 3550, spent: 0, img: "" },
            { id: 17, name: "سليمان الظاهري", total: 3530, current: 3530, spent: 0, img: "" },
            { id: 18, name: "عبد العزيز ناصر المناع", total: 3390, current: 3390, spent: 0, img: "" },
            { id: 19, name: "محمد عبد الرحمن الحماد", total: 3300, current: 3300, spent: 0, img: "" },
            { id: 20, name: "يزيد العيسى", total: 3240, current: 3240, spent: 0, img: "" },
            { id: 21, name: "تركي الشهيل", total: 3180, current: 3180, spent: 0, img: "" },
            { id: 22, name: "عبد اللطيف المناع", total: 3050, current: 3050, spent: 0, img: "" },
            { id: 23, name: "يعرب اللحيدان", total: 3010, current: 3010, spent: 0, img: "" },
            { id: 24, name: "عزام عبد السلام المناع", total: 2900, current: 2900, spent: 0, img: "" },
            { id: 25, name: "سعد اليحيى", total: 2520, current: 2520, spent: 0, img: "" },
            { id: 26, name: "مشعل الدهاسي", total: 2260, current: 2260, spent: 0, img: "" },
            { id: 27, name: "مازن عبد الرحمن العرفج", total: 2000, current: 2000, spent: 0, img: "" },
            { id: 28, name: "محمد حمد المناع", total: 1960, current: 1960, spent: 0, img: "" }
        ];
        let idCounter = 29;

        // ==========================
        // واجهة الطلاب
        // ==========================
        function renderStudents() {
            const list = document.getElementById("studentsList");
            const select = document.getElementById("studentSelect");
            list.innerHTML = "";
            select.innerHTML = "";

            students.forEach(s => {
                const div = document.createElement("div");
                div.className = "studentCard " + (s.current <= 200 ? "low" : "");

                div.innerHTML = `
            <img src="${s.img || ''}">
            <input type="file" accept="image/*" onchange="updateImage(${s.id}, event)">
            <div class="name">${s.name}</div>
            <div class="points">النقاط الأصلية: ${s.total}</div>
            <div class="points">المتبقي: ${s.current}</div>
            <div class="points">المصروف: ${s.spent}</div>

            <button onclick="resetStudent(${s.id})">إعادة تعيين</button>
            <button onclick="removeStudent(${s.id})" style="background:#c0392b;color:white">حذف</button>
        `;
                list.appendChild(div);

                const option = document.createElement("option");
                option.value = s.id;
                option.text = s.name;
                select.appendChild(option);
            });
        }

        // ==========================
        // تحديث صورة الطالب
        // ==========================
        function updateImage(id, event) {
            let file = event.target.files[0];
            if (!file) return;

            let reader = new FileReader();
            reader.onload = () => {
                let s = students.find(x => x.id === id);
                if (!s) return;
                s.img = reader.result;
                renderStudents();
            };
            reader.readAsDataURL(file);
        }

        // ==========================
        // إضافة طالب
        // ==========================
        function addStudent() {
            let name = document.getElementById("nameInput").value.trim();
            let points = Number(document.getElementById("pointsInput").value);
            let imgFile = document.getElementById("imgInput").files[0];

            if (!name || !points) {
                alert("يرجى إدخال الاسم والنقاط");
                return;
            }

            points = points * POINTS_MULTIPLIER;

            let reader = new FileReader();
            reader.onload = () => {
                students.push({
                    id: idCounter++,
                    name: name,
                    total: points,
                    current: points,
                    spent: 0,
                    img: reader.result
                });
                renderStudents();
            };

            if (imgFile) {
                reader.readAsDataURL(imgFile);
            } else {
                students.push({
                    id: idCounter++,
                    name: name,
                    total: points,
                    current: points,
                    spent: 0,
                    img: ""
                });
                renderStudents();
            }

            document.getElementById("nameInput").value = "";
            document.getElementById("pointsInput").value = "";
            document.getElementById("imgInput").value = "";
        }

        // ==========================
        // خصم النقاط
        // ==========================
        function deductPoints() {
            let id = Number(document.getElementById("studentSelect").value);
            let value = Number(document.getElementById("deductInput").value);

            if (!id) {
                alert("اختر الطالب أولاً");
                return;
            }

            if (!value) {
                alert("أدخل قيمة الخصم");
                return;
            }

            let s = students.find(x => x.id === id);
            if (!s) {
                alert("لم يتم العثور على الطالب");
                return;
            }

            if (s.current - value < 0) {
                alert("لا يمكن أن تكون نقاط الطالب أقل من صفر");
                return;
            }

            s.current -= value;
            s.spent += value;

            log(`تم خصم ${value} نقطة من الطالب ${s.name} — الرصيد الحالي: ${s.current} نقطة`);
            renderStudents();
            document.getElementById("deductInput").value = "";
        }

        // ==========================
        // أدوات التحكم
        // ==========================
        function resetStudent(id) {
            if (!confirm("هل تريد إعادة نقاط هذا الطالب؟")) return;
            let s = students.find(x => x.id === id);
            if (!s) return;
            s.current = s.total;
            s.spent = 0;
            renderStudents();
        }

        function removeStudent(id) {
            if (!confirm("هل تريد حذف هذا الطالب؟")) return;
            students = students.filter(s => s.id !== id);
            renderStudents();
        }

        function resetAll() {
            if (!confirm("هل تريد إعادة تعيين جميع الطلاب؟")) return;
            students.forEach(s => {
                s.current = s.total;
                s.spent = 0;
            });
            renderStudents();
        }

        // ==========================
        // سجل العمليات
        // ==========================
        function log(text) {
            let box = document.getElementById("history");
            let p = document.createElement("div");
            p.textContent = text;
            box.prepend(p);
        }

        // تشغيل أولي
        renderStudents();
    </script>

</body>

</html>