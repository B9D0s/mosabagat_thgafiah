<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÿØÿ±ÿ¨ÿßÿ™ ŸàÿØÿ±ŸÉÿßÿ™</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
/* ============================================
   RESET & VARIABLES
   ============================================ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#F4F0E4;
  --accent:#44A194;
  --secondary:#537D96;
  --highlight:#EC8F8D;
  --white:#fff;
  --dark:#2a2a2a;
  --gray:#999;
  --border:#e2ded2;
  --r:16px;
  --rs:10px;
  --rf:50px;
  --shadow:0 6px 28px rgba(0,0,0,0.08);
  --shadow-lg:0 14px 48px rgba(0,0,0,0.13);
  --ease:cubic-bezier(.4,0,.2,1);
  --green:#2ecc71;
  --red:#e74c3c;
}
html{height:100%}
body{
  font-family:'Tajawal',sans-serif;
  background:var(--bg);
  color:var(--dark);
  min-height:100vh;
  overflow-x:hidden;
}

/* ============================================
   ANIMATIONS
   ============================================ */
@keyframes fadeUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
@keyframes scaleIn{from{opacity:0;transform:scale(.88)}to{opacity:1;transform:scale(1)}}
@keyframes bounceIn{0%{transform:scale(.3);opacity:0}50%{transform:scale(1.06)}70%{transform:scale(.96)}100%{transform:scale(1);opacity:1}}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.04)}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes confetti{0%{transform:translateY(-100vh) rotate(0);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
@keyframes glow{0%,100%{box-shadow:0 0 8px rgba(68,161,148,.2)}50%{box-shadow:0 0 24px rgba(68,161,148,.45)}}
@keyframes slideDown{from{transform:translateX(-50%) translateY(-80px)}to{transform:translateX(-50%) translateY(0)}}
@keyframes timerTick{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}
@keyframes crownFloat{0%,100%{transform:translateY(0) rotate(-3deg)}50%{transform:translateY(-10px) rotate(3deg)}}
@keyframes scoreCount{from{transform:scale(1.3);opacity:.5}to{transform:scale(1);opacity:1}}
@keyframes glowPulse{
  0%,100%{box-shadow:0 0 6px 2px var(--glow-color,rgba(68,161,148,.3))}
  50%{box-shadow:0 0 18px 6px var(--glow-color,rgba(68,161,148,.5))}
}

/* ============================================
   SPA SCREEN SYSTEM ‚Äî strict single screen
   ============================================ */
.screen{
  display:none !important;
}
.screen.active{
  display:flex !important;
  animation:fadeUp .4s var(--ease);
}

/* ============================================
   CENTERED SCREEN LAYOUT
   All screens use flex centering by default.
   Screens with scrollable board content use
   flex-direction:column + align-items:center.
   ============================================ */
.screen{
  min-height:100vh;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  width:100%;
}
/* Board/Cat screens need full width children */
#boardScreen,#catScreen{
  align-items:stretch;
  justify-content:flex-start;
  padding-top:10px;
}

.container{max-width:1100px;margin:0 auto;padding:20px 16px;width:100%}

/* ============================================
   BUTTONS
   ============================================ */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:8px;
  padding:12px 28px;border:none;border-radius:var(--rs);
  font-family:inherit;font-size:1rem;font-weight:700;
  cursor:pointer;transition:all .3s var(--ease);position:relative;overflow:hidden;
}
.btn:active{transform:scale(.97)}
.btn:disabled{opacity:.4;cursor:not-allowed;transform:none!important}
.btn-accent{background:var(--accent);color:var(--white);box-shadow:0 4px 16px rgba(68,161,148,.3)}
.btn-accent:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 24px rgba(68,161,148,.4)}
.btn-secondary{background:var(--secondary);color:var(--white)}
.btn-secondary:hover:not(:disabled){transform:translateY(-2px)}
.btn-highlight{background:var(--highlight);color:var(--white)}
.btn-outline{background:transparent;border:2px solid var(--accent);color:var(--accent)}
.btn-outline:hover:not(:disabled){background:var(--accent);color:var(--white)}
.btn-sm{padding:8px 18px;font-size:.88rem}
.btn-lg{padding:14px 36px;font-size:1.1rem}

/* ============================================
   CARDS & INPUTS
   ============================================ */
.card{background:var(--white);border-radius:var(--r);padding:28px;box-shadow:var(--shadow)}
.input,.select-field{
  width:100%;padding:12px 16px;border:2px solid var(--border);
  border-radius:var(--rs);font-family:inherit;font-size:1rem;font-weight:500;
  background:var(--bg);color:var(--dark);transition:border-color .3s;text-align:right;
  appearance:none;-webkit-appearance:none;
}
.input:focus,.select-field:focus{outline:none;border-color:var(--accent)}
.select-field{cursor:pointer;padding-left:36px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23999' stroke-width='2' fill='none'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:16px center}

/* ============================================
   WELCOME SCREEN ‚Äî perfectly centered
   ============================================ */
#welcomeScreen{
  padding:20px 16px;
}
.welcome-inner{max-width:540px;width:100%;text-align:center}
.welcome-logo{
  width:120px;height:120px;margin:0 auto 20px;
  background:linear-gradient(135deg,var(--accent),var(--secondary));
  border-radius:50%;display:flex;align-items:center;justify-content:center;
  font-size:2.6rem;font-weight:900;color:var(--white);
  animation:glow 3s ease-in-out infinite;
}
.welcome-inner h1{font-size:2.2rem;color:var(--accent);margin-bottom:4px}
.welcome-inner .sub{color:var(--gray);margin-bottom:28px;font-size:1rem}
.welcome-inner .card{text-align:right}
.field{margin-bottom:16px}
.field label{display:block;margin-bottom:6px;font-weight:700;font-size:.92rem;color:var(--secondary)}
.team-dot{display:inline-block;width:10px;height:10px;border-radius:50%;margin-left:6px;vertical-align:middle}
.welcome-actions{text-align:center;margin-top:20px}
.form-err{text-align:center;color:var(--highlight);font-weight:700;font-size:.88rem;min-height:1.2em;margin-top:8px}

#teamInputsArea{max-height:300px;overflow-y:auto;padding:4px 0}
#teamInputsArea .field{animation:fadeUp .3s var(--ease)}

.td0{background:#44A194}.td1{background:#EC8F8D}.td2{background:#537D96}
.td3{background:#e6a23c}.td4{background:#9b59b6}.td5{background:#1abc9c}
.td6{background:#e74c3c}.td7{background:#3498db}

/* ============================================
   CATEGORY SELECTION
   ============================================ */
#catScreen .container{max-width:750px}
.cat-header{text-align:center;margin-bottom:20px}
.cat-header h2{color:var(--accent);font-size:1.5rem}
.cat-header p{color:var(--gray);font-size:.95rem;margin-top:4px}

.cat-turn{
  text-align:center;padding:10px 20px;border-radius:var(--rf);
  font-weight:700;font-size:1rem;margin-bottom:16px;transition:all .3s;
}
.cat-grid{
  display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:10px;
  margin-bottom:20px;
}
.cat-card{
  background:var(--white);border:2px solid var(--border);border-radius:var(--r);
  padding:16px 12px;text-align:center;cursor:pointer;
  transition:all .3s var(--ease);font-weight:700;font-size:.95rem;
}
.cat-card:hover:not(.picked):not(.disabled){
  border-color:var(--accent);transform:translateY(-3px);box-shadow:var(--shadow);
}
.cat-card.picked{opacity:.5;cursor:not-allowed;border-style:dashed}
.cat-card .cat-icon{font-size:1.5rem;margin-bottom:4px;display:block}
.cat-card .cat-count{font-size:.72rem;color:var(--gray);font-weight:500;margin-top:3px}

.cat-selected{display:flex;gap:16px;justify-content:center;flex-wrap:wrap;margin-bottom:16px}
.cat-sel-group h4{font-size:.85rem;font-weight:700;margin-bottom:4px;text-align:center}
.cat-sel-group .chips{display:flex;gap:5px;flex-wrap:wrap;justify-content:center}
.cat-sel-group .chip{
  padding:3px 10px;border-radius:var(--rf);font-size:.78rem;font-weight:600;
  background:rgba(68,161,148,.1);color:var(--accent);
}
.cat-actions{text-align:center}

/* ============================================
   GAME BOARD
   ============================================ */

/* Top scoreboard */
.board-top{
  display:flex;justify-content:center;align-items:center;
  gap:10px;flex-wrap:wrap;padding:10px 0;margin-bottom:6px;
}
.ts-box{
  background:var(--white);border-radius:var(--r);padding:10px 14px;
  display:flex;align-items:center;gap:10px;
  box-shadow:0 3px 12px rgba(0,0,0,.05);
  transition:all .4s var(--ease);min-width:110px;
  border:3px solid transparent;
}
/* Active team highlight ‚Äî dynamic glow */
.ts-box.active-t{
  transform:scale(1.06);
  animation:glowPulse 1.8s ease-in-out infinite;
}
.ts-box .ts-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.ts-box .ts-name{font-weight:700;font-size:.85rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:80px}
.ts-box .ts-score{font-size:1.4rem;font-weight:900;margin-right:auto}

/* Turn badge ‚Äî color set dynamically via inline style */
.turn-badge{
  color:var(--white);padding:6px 16px;
  border-radius:var(--rf);font-size:.82rem;font-weight:700;
  white-space:nowrap;transition:background .3s;
}

/* Board grid */
.board-grid{display:grid;gap:8px;margin-bottom:14px}
.board-col-header{
  background:var(--secondary);color:var(--white);
  border-radius:var(--rs) var(--rs) 0 0;
  padding:10px 4px;text-align:center;
  font-weight:700;font-size:.8rem;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.board-cell{
  background:var(--white);border:2px solid var(--border);
  border-radius:var(--rs);padding:12px 4px;text-align:center;
  cursor:pointer;transition:all .25s var(--ease);
  font-weight:800;font-size:.95rem;color:var(--accent);
  min-height:48px;display:flex;align-items:center;justify-content:center;
}
.board-cell:hover:not(.used){
  border-color:var(--accent);transform:translateY(-2px);box-shadow:var(--shadow);
}
.board-cell.used{
  background:var(--bg);border-color:transparent;
  color:var(--border);cursor:default;
}
.board-cell.used i{color:var(--accent);opacity:.4}
.board-cell.pts-200{color:var(--accent)}
.board-cell.pts-400{color:var(--secondary)}
.board-cell.pts-600{color:var(--highlight);font-size:1rem}

/* Lifelines */
.ll-section{margin-bottom:12px}
.ll-section-title{text-align:center;font-size:.82rem;color:var(--gray);font-weight:600;margin-bottom:8px}
.lifelines-row{display:flex;justify-content:center;gap:10px;flex-wrap:wrap}
.ll-group{
  display:flex;align-items:center;gap:5px;
  background:var(--white);border-radius:var(--r);padding:7px 10px;
  box-shadow:0 2px 8px rgba(0,0,0,.04);
}
.ll-group .ll-label{font-weight:700;font-size:.75rem;max-width:65px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.ll-btn{
  width:34px;height:34px;border-radius:50%;border:2px solid var(--border);
  background:var(--white);cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:all .25s;font-size:.85rem;color:var(--secondary);
  position:relative;
}
.ll-btn:hover:not(:disabled){border-color:var(--accent);color:var(--accent);transform:scale(1.08)}
.ll-btn:disabled{opacity:.25;cursor:not-allowed}
.ll-btn.active-ll{border-color:var(--highlight);color:var(--highlight);animation:pulse .8s infinite}
/* Tooltip for lifeline */
.ll-btn[title]:hover::after{
  content:attr(title);position:absolute;bottom:110%;left:50%;transform:translateX(-50%);
  background:var(--dark);color:var(--white);padding:3px 10px;border-radius:6px;
  font-size:.7rem;white-space:nowrap;pointer-events:none;z-index:10;
}

/* ============================================
   QUESTION MODAL
   ============================================ */
.modal-overlay{
  position:fixed;inset:0;background:rgba(30,30,30,.85);
  display:none;align-items:center;justify-content:center;
  z-index:1000;padding:16px;
}
.modal-overlay.show{display:flex}
.modal-box{
  background:var(--white);border-radius:var(--r);padding:28px 24px;
  max-width:580px;width:100%;box-shadow:var(--shadow-lg);
  animation:scaleIn .35s var(--ease);position:relative;
  max-height:90vh;overflow-y:auto;
}
.modal-close{
  position:absolute;top:10px;left:10px;background:none;border:none;
  font-size:1.3rem;color:var(--gray);cursor:pointer;transition:color .2s;
}
.modal-close:hover{color:var(--dark)}

.modal-cat{
  display:inline-block;background:rgba(68,161,148,.08);color:var(--accent);
  padding:3px 14px;border-radius:var(--rf);font-size:.76rem;font-weight:700;
  margin-bottom:10px;
}
.modal-pts-badge{
  display:inline-block;margin-right:8px;background:rgba(83,125,150,.1);color:var(--secondary);
  padding:3px 12px;border-radius:var(--rf);font-size:.76rem;font-weight:700;
}
.modal-q{
  font-size:1.15rem;font-weight:700;line-height:1.9;text-align:center;margin-bottom:16px;
}
.modal-timer{text-align:center;margin-bottom:14px}
.modal-timer .mt-num{font-size:1.8rem;font-weight:900;color:var(--accent);transition:color .3s}
.modal-timer .mt-num.warn{color:var(--highlight);animation:timerTick .5s infinite}
.modal-timer .mt-bar{height:5px;background:var(--border);border-radius:4px;margin-top:5px;overflow:hidden}
.modal-timer .mt-fill{height:100%;background:var(--accent);border-radius:4px;transition:width 1s linear,background .3s}
.modal-timer .mt-fill.warn{background:var(--highlight)}

.modal-opts{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.mo-btn{
  background:var(--white);border:2px solid var(--border);border-radius:var(--rs);
  padding:13px 10px;font-family:inherit;font-size:.97rem;font-weight:600;
  cursor:pointer;transition:all .25s var(--ease);text-align:center;
}
.mo-btn:hover:not(:disabled):not(.correct):not(.wrong){border-color:var(--accent);transform:translateY(-2px)}
.mo-btn:disabled{cursor:not-allowed}
/* Correct = vivid green */
.mo-btn.correct{
  background:var(--green) !important;
  border-color:var(--green) !important;
  color:var(--white) !important;
  animation:bounceIn .4s;
  transform:scale(1.03);
}
/* Wrong = vivid red */
.mo-btn.wrong{
  background:var(--red) !important;
  border-color:var(--red) !important;
  color:var(--white) !important;
  animation:shake .4s;
}
/* Reveal correct after wrong */
.mo-btn.reveal{
  background:rgba(46,204,113,.15) !important;
  border-color:var(--green) !important;
  color:var(--green) !important;
}
.mo-btn .mo-lbl{
  display:inline-flex;width:24px;height:24px;border-radius:50%;background:var(--bg);
  align-items:center;justify-content:center;font-size:.73rem;font-weight:800;
  margin-left:6px;vertical-align:middle;transition:all .25s;
}
.mo-btn.correct .mo-lbl,.mo-btn.wrong .mo-lbl{background:rgba(255,255,255,.25);color:var(--white)}

.modal-feedback{
  text-align:center;margin-top:14px;font-weight:700;font-size:.95rem;min-height:1.3em;
}
.modal-feedback.ok{color:var(--green)}
.modal-feedback.fail{color:var(--red)}

.modal-ll-info{
  text-align:center;margin-bottom:10px;padding:5px 12px;
  border-radius:var(--rf);font-size:.82rem;font-weight:700;
}
.ll-info-hole{background:rgba(236,143,141,.1);color:var(--highlight)}
.ll-info-double{background:rgba(83,125,150,.1);color:var(--secondary)}
.ll-info-call{background:rgba(68,161,148,.1);color:var(--accent)}
.ll-info-rest{background:rgba(155,89,182,.1);color:#9b59b6}

/* Rest lifeline modal */
.rest-overlay{
  position:fixed;inset:0;background:rgba(30,30,30,.8);
  display:none;align-items:center;justify-content:center;
  z-index:1001;padding:16px;
}
.rest-overlay.show{display:flex}
.rest-box{
  background:var(--white);border-radius:var(--r);padding:28px;
  max-width:400px;width:100%;text-align:center;
  box-shadow:var(--shadow-lg);animation:scaleIn .3s var(--ease);
}
.rest-box h3{color:#9b59b6;margin-bottom:12px;font-size:1.1rem}
.rest-box p{color:var(--gray);font-size:.9rem;margin-bottom:16px}
.rest-badge{
  display:inline-block;background:#9b59b6;color:var(--white);
  padding:6px 20px;border-radius:var(--rf);font-weight:700;font-size:.9rem;
  margin-bottom:8px;
}

/* ============================================
   RESULT SCREEN ‚Äî grand game over
   ============================================ */
#resultScreen{padding:20px 16px}
.result-inner{max-width:580px;width:100%;text-align:center}
.result-box{
  background:var(--white);border-radius:var(--r);padding:36px 24px;
  box-shadow:var(--shadow-lg);animation:scaleIn .5s var(--ease);
  position:relative;overflow:hidden;
}
.result-box::before{
  content:'';position:absolute;top:-60px;left:-60px;
  width:160px;height:160px;border-radius:50%;
  background:radial-gradient(circle,rgba(68,161,148,.1),transparent);
  pointer-events:none;
}
.result-box::after{
  content:'';position:absolute;bottom:-40px;right:-40px;
  width:120px;height:120px;border-radius:50%;
  background:radial-gradient(circle,rgba(236,143,141,.1),transparent);
  pointer-events:none;
}
.trophy{font-size:4.5rem;margin-bottom:8px;animation:crownFloat 3s ease-in-out infinite;display:inline-block}
.res-winner{font-size:2rem;font-weight:900;color:var(--accent);margin-bottom:2px}
.res-sub{color:var(--gray);font-weight:600;margin-bottom:24px;font-size:.95rem}
.res-scores{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:10px;margin-bottom:28px}
.res-team{background:var(--bg);border-radius:var(--rs);padding:16px 10px;position:relative}
.res-team.win{border:3px solid var(--accent);background:rgba(68,161,148,.04)}
.res-team .rt-rank{font-size:.7rem;color:var(--gray);font-weight:600}
.res-team .rt-name{font-weight:700;font-size:.88rem;margin-bottom:3px}
.res-team .rt-score{font-size:1.6rem;font-weight:900;animation:scoreCount .6s var(--ease)}
.res-team.win .rt-score{color:var(--accent)}
.res-team:not(.win) .rt-score{color:var(--gray)}
.res-actions{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.tie-icon{font-size:3.5rem;margin-bottom:8px}
.tie-text{font-size:1.7rem;font-weight:900;color:var(--secondary);margin-bottom:2px}

/* Game Over label */
.game-over-label{
  font-size:.8rem;font-weight:700;color:var(--highlight);
  text-transform:uppercase;letter-spacing:2px;margin-bottom:12px;
}

.confetti{position:fixed;top:-20px;z-index:1050;animation:confetti linear forwards}

/* ============================================
   TOAST
   ============================================ */
.toast{
  position:fixed;top:14px;left:50%;transform:translateX(-50%) translateY(-80px);
  padding:10px 24px;border-radius:var(--rf);font-weight:700;font-size:.9rem;
  color:var(--white);z-index:1100;font-family:'Tajawal',sans-serif;
  transition:transform .4s var(--ease);white-space:nowrap;
}
.toast.show{animation:slideDown .4s var(--ease) forwards}
.toast.t-ok{background:var(--green)}
.toast.t-fail{background:var(--red)}
.toast.t-info{background:var(--secondary)}

/* ============================================
   FOOTER
   ============================================ */
.footer{
  position:fixed;bottom:0;left:0;right:0;text-align:center;
  padding:8px;font-size:.76rem;font-weight:600;color:var(--gray);
  background:rgba(244,240,228,.92);backdrop-filter:blur(8px);z-index:100;
}
.footer a{color:var(--accent);text-decoration:none;font-weight:700}

/* ============================================
   RESPONSIVE
   ============================================ */
@media(max-width:768px){
  .modal-opts{grid-template-columns:1fr}
  .ts-box{min-width:auto;padding:8px 10px}
  .ts-box .ts-name{max-width:50px;font-size:.78rem}
  .ts-box .ts-score{font-size:1.1rem}
  .turn-badge{font-size:.75rem;padding:5px 12px}
}
@media(max-width:500px){
  .cat-grid{grid-template-columns:repeat(2,1fr)}
  .welcome-logo{width:90px;height:90px;font-size:2rem}
  .welcome-inner h1{font-size:1.7rem}
  .board-col-header{font-size:.68rem;padding:8px 2px}
  .board-cell{padding:10px 2px;font-size:.8rem;min-height:40px}
  .ll-group{padding:5px 8px;gap:4px}
  .ll-btn{width:30px;height:30px;font-size:.78rem}
}
</style>
</head>
<body>

<!-- ====== WELCOME ‚Äî centered ====== -->
<div id="welcomeScreen" class="screen active">
  <div class="welcome-inner">
    <div class="welcome-logo">ÿØÿØ</div>
    <h1>ÿØÿ±ÿ¨ÿßÿ™ ŸàÿØÿ±ŸÉÿßÿ™</h1>
    <p class="sub">ŸÖÿ≥ÿßÿ®ŸÇÿ© ÿßŸÑŸÅÿ±ŸÇ ‚Äî ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÖÿπÿ±ŸÅŸä</p>
    <div class="card">
      <div class="field">
        <label><i class="fas fa-users"></i> ÿπÿØÿØ ÿßŸÑŸÅÿ±ŸÇ / ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ</label>
        <select id="numTeamsSelect" class="select-field" onchange="App.buildTeamInputs()">
          <option value="2">Ÿ¢ ŸÅÿ±ŸÇ</option>
          <option value="3">Ÿ£ ŸÅÿ±ŸÇ</option>
          <option value="4">Ÿ§ ŸÅÿ±ŸÇ</option>
          <option value="5">Ÿ• ŸÅÿ±ŸÇ</option>
          <option value="6">Ÿ¶ ŸÅÿ±ŸÇ</option>
        </select>
      </div>
      <div class="field">
        <label><i class="fas fa-th-large"></i> ÿπÿØÿØ ÿßŸÑŸÅÿ¶ÿßÿ™ (ÿπÿØÿØ ÿ≤Ÿàÿ¨Ÿä)</label>
        <select id="numCatsSelect" class="select-field">
          <option value="4">Ÿ§ ŸÅÿ¶ÿßÿ™</option>
          <option value="6" selected>Ÿ¶ ŸÅÿ¶ÿßÿ™</option>
          <option value="8">Ÿ® ŸÅÿ¶ÿßÿ™</option>
          <option value="10">Ÿ°Ÿ† ŸÅÿ¶ÿßÿ™</option>
        </select>
      </div>
      <hr style="border:none;border-top:1px solid var(--border);margin:16px 0">
      <div id="teamInputsArea"></div>
      <div class="form-err" id="welErr"></div>
      <div class="welcome-actions">
        <button class="btn btn-accent btn-lg" onclick="App.goCategories()">ÿßŸÑÿ™ÿßŸÑŸä <i class="fas fa-arrow-left"></i></button>
      </div>
    </div>
  </div>
</div>

<!-- ====== CATEGORY SELECTION ====== -->
<div id="catScreen" class="screen">
  <div class="container">
    <div class="cat-header">
      <h2>ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÅÿ¶ÿßÿ™</h2>
      <p id="catHeaderSub"></p>
    </div>
    <div class="cat-turn" id="catTurn"></div>
    <div class="cat-grid" id="catGrid"></div>
    <div class="cat-selected" id="catSelected"></div>
    <div class="cat-actions">
      <button class="btn btn-accent btn-lg" id="catStartBtn" onclick="App.startBoard()" disabled>ÿßÿ®ÿØÿ£ ÿßŸÑŸÑÿπÿ®ÿ© <i class="fas fa-play"></i></button>
    </div>
  </div>
</div>

<!-- ====== GAME BOARD ====== -->
<div id="boardScreen" class="screen">
  <div class="container">
    <div class="board-top" id="boardTop"></div>
    <div class="ll-section">
      <div class="ll-section-title">Ÿàÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©</div>
      <div class="lifelines-row" id="llRow"></div>
    </div>
    <div class="board-grid" id="boardGrid"></div>
  </div>
</div>

<!-- ====== RESULT / GAME OVER ====== -->
<div id="resultScreen" class="screen">
  <div class="result-inner">
    <div class="result-box" id="resultBox"></div>
  </div>
</div>

<!-- Question Modal -->
<div class="modal-overlay" id="qModal">
  <div class="modal-box" id="qModalBox"></div>
</div>

<!-- Rest Lifeline Modal -->
<div class="rest-overlay" id="restModal">
  <div class="rest-box" id="restBox"></div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- Footer -->
<div class="footer">ÿµŸÜÿπ ÿ®ÿ•ÿ®ÿØÿßÿπ ÿ®Ÿàÿßÿ≥ÿ∑ÿ© <a href="#">ŸÖÿØÿßÿØ</a></div>

<script>
/* ============================================
   CONSTANTS
   ============================================ */
const API_URL = 'https://raw.githubusercontent.com/B9D0s/mosabagat_thgafiah/main/data/questions.json';
const LABELS = ['ÿ£','ÿ®','ÿ¨','ÿØ'];
const AR = ['Ÿ†','Ÿ°','Ÿ¢','Ÿ£','Ÿ§','Ÿ•','Ÿ¶','Ÿß','Ÿ®','Ÿ©'];
const toAr = n => String(n).replace(/\d/g, d => AR[d]);
const $ = id => document.getElementById(id);

const Q_PER_CAT = 6;
const POINT_TIERS = [200, 200, 400, 400, 600, 600];
const BASE_TIME = 30;
const CALL_EXTRA = 30;
const ANSWER_SHOW_DELAY = 2000; // 2 seconds to show green/red

const CAT_ICONS = ['üß†','üìö','üåç','‚ö°','üî¨','üéØ','üèõÔ∏è','üé≠','‚öΩ','üåô','üìñ','üí°','üéì','üó∫Ô∏è','üî≠','üèÜ','üé®','üîÆ'];
const GENERIC_NAMES = ['ÿ´ŸÇÿßŸÅÿ© ÿπÿßŸÖÿ©','ÿ™ÿßÿ±ŸäÿÆ Ÿàÿ≠ÿ∂ÿßÿ±ÿßÿ™','ÿπŸÑŸàŸÖ ŸàŸÖÿπÿ±ŸÅÿ©','ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß','ÿ£ÿØÿ® ŸàŸÑÿ∫ÿ©','ÿ±Ÿäÿßÿ∂ÿ©','ŸÅŸÜŸàŸÜ','ÿ∑ÿ®Ÿäÿπÿ©','ÿ™ŸÇŸÜŸäÿ©','ÿ•ÿ≥ŸÑÿßŸÖŸäÿßÿ™','ÿµÿ≠ÿ©','ŸÅŸÑŸÉ','ÿßÿÆÿ™ÿ±ÿßÿπÿßÿ™','ŸÖÿ¨ÿ™ŸÖÿπ','ÿßŸÇÿ™ÿµÿßÿØ','ÿ≥Ÿäÿßÿ≥ÿ©'];
const TEAM_COLORS = ['#44A194','#EC8F8D','#537D96','#e6a23c','#9b59b6','#1abc9c','#e74c3c','#3498db'];

/* ============================================
   STATE
   ============================================ */
const G = {
  numTeams: 2,
  numCats: 6,
  teams: [],
  allCategories: [],
  teamPicks: [],
  pickTurn: 0,
  chosenCats: [],
  turn: 0,
  boardUsed: new Set(),
  totalCells: 0,
  answeredCount: 0,
  lifelines: [],       // [{call, double, hole, rest}]
  activeHole: false,
  activeDouble: false,
  activeCall: false,
  activeRest: false,   // rest lifeline active
  restTarget: -1,      // which team is rested (sits out)
  doubleUsed: false,
  timerID: null,
  timerVal: 0,
  locked: false,
  currentQ: null,
  currentCell: null,
  currentPts: 0,
  rawCache: null
};

function resetG() {
  G.teams = [];
  G.allCategories = [];
  G.teamPicks = [];
  G.pickTurn = 0;
  G.chosenCats = [];
  G.turn = 0;
  G.boardUsed.clear();
  G.totalCells = 0;
  G.answeredCount = 0;
  G.lifelines = [];
  G.activeHole = false;
  G.activeDouble = false;
  G.activeCall = false;
  G.activeRest = false;
  G.restTarget = -1;
  G.doubleUsed = false;
  G.locked = false;
  G.currentQ = null;
  G.currentCell = null;
  G.currentPts = 0;
  stopTimer();
}

/* ============================================
   TIMER
   ============================================ */
function startTimer(sec, onTick, onEnd) {
  stopTimer();
  G.timerVal = sec;
  onTick(sec, sec);
  G.timerID = setInterval(() => {
    G.timerVal--;
    onTick(G.timerVal, sec);
    if (G.timerVal <= 0) { stopTimer(); onEnd(); }
  }, 1000);
}
function stopTimer() {
  if (G.timerID) { clearInterval(G.timerID); G.timerID = null; }
}

/* ============================================
   UTILITIES
   ============================================ */
function shuffle(a) {
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  $(id).classList.add('active');
  window.scrollTo(0, 0);
}

function toast(type, msg) {
  const t = $('toast');
  t.textContent = msg;
  t.className = `toast t-${type}`;
  requestAnimationFrame(() => t.classList.add('show'));
  setTimeout(() => t.classList.remove('show'), 2000);
}

function openModal() { $('qModal').classList.add('show'); }
function closeModal() { $('qModal').classList.remove('show'); }

function spawnConfetti() {
  const colors = TEAM_COLORS.concat(['#FFD700','#F4F0E4','#2ecc71']);
  for (let i = 0; i < 60; i++) {
    const el = document.createElement('div');
    el.className = 'confetti';
    el.style.left = Math.random() * 100 + 'vw';
    el.style.width = (6 + Math.random() * 10) + 'px';
    el.style.height = (6 + Math.random() * 10) + 'px';
    el.style.background = colors[Math.floor(Math.random() * colors.length)];
    el.style.borderRadius = Math.random() > .5 ? '50%' : '2px';
    el.style.animationDuration = (2.5 + Math.random() * 3) + 's';
    el.style.animationDelay = (Math.random() * 2) + 's';
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 7000);
  }
}

/* ============================================
   API & DATA
   ============================================ */
async function loadQuestions() {
  try {
    if (G.rawCache) return G.rawCache;
    const r = await fetch(API_URL);
    if (!r.ok) throw 0;
    const data = await r.json();
    if (!Array.isArray(data) || !data.length) throw 0;
    G.rawCache = data;
    return data;
  } catch {
    return null;
  }
}

function transformQ(raw) {
  if (raw.type === 'mcq' && raw.question_ar && Array.isArray(raw.options_ar) && raw.options_ar.length === 4 && typeof raw.correctIndex === 'number') {
    return { q: raw.question_ar, opts: [...raw.options_ar], ans: raw.correctIndex, cat: raw.category || '', exp: raw.explanation_ar || '' };
  }
  if (raw.type === 'tf' && raw.question_ar && typeof raw.correctBoolean === 'boolean') {
    return { q: raw.question_ar, opts: ['ÿµÿ≠','ÿÆÿ∑ÿ£','ŸÑÿß ÿ£ÿπÿ±ŸÅ','ÿ™ÿÆÿ∑Ÿä'], ans: raw.correctBoolean ? 0 : 1, cat: raw.category || '', exp: raw.explanation_ar || '' };
  }
  return null;
}

function buildCategories(rawData) {
  const cats = {};
  for (const raw of rawData) {
    const t = transformQ(raw);
    if (!t) continue;
    const key = t.cat || 'ÿπÿßŸÖ';
    if (!cats[key]) cats[key] = [];
    cats[key].push(t);
  }
  const result = [];
  let iconIdx = 0;
  for (const [name, qs] of Object.entries(cats)) {
    if (qs.length >= Q_PER_CAT) {
      result.push({ name, icon: CAT_ICONS[iconIdx % CAT_ICONS.length], questions: shuffle(qs).slice(0, Q_PER_CAT) });
      iconIdx++;
    }
  }
  if (result.length < 16) {
    const usedQs = new Set(result.flatMap(c => c.questions.map(q => q.q)));
    const leftover = [];
    for (const raw of rawData) {
      const t = transformQ(raw);
      if (t && !usedQs.has(t.q)) leftover.push(t);
    }
    shuffle(leftover);
    let genIdx = 0;
    while (leftover.length >= Q_PER_CAT && result.length < 16) {
      const chunk = leftover.splice(0, Q_PER_CAT);
      result.push({
        name: GENERIC_NAMES[genIdx % GENERIC_NAMES.length],
        icon: CAT_ICONS[(iconIdx + genIdx) % CAT_ICONS.length],
        questions: chunk
      });
      genIdx++;
    }
  }
  return shuffle(result);
}

const FALLBACK_RAW = [
  {type:'mcq',question_ar:'ŸÖÿß ÿπÿßÿµŸÖÿ© ÿØŸàŸÑÿ© ÿßŸÑŸÉŸàŸäÿ™ÿü',options_ar:['ŸÖÿØŸäŸÜÿ© ÿßŸÑŸÉŸàŸäÿ™','ÿßŸÑÿ¨Ÿáÿ±ÿßÿ°','ÿ≠ŸàŸÑŸä','ÿßŸÑÿ£ÿ≠ŸÖÿØŸä'],correctIndex:0,category:'ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß'},
  {type:'mcq',question_ar:'ŸÉŸÖ ÿπÿØÿØ ÿ£ÿ±ŸÉÿßŸÜ ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖÿü',options_ar:['ÿ£ÿ±ÿ®ÿπÿ©','ÿÆŸÖÿ≥ÿ©','ÿ≥ÿ™ÿ©','ÿ´ŸÑÿßÿ´ÿ©'],correctIndex:1,category:'ÿ•ÿ≥ŸÑÿßŸÖŸäÿßÿ™'},
  {type:'mcq',question_ar:'ŸÖÿß ÿ£ÿ∑ŸàŸÑ ŸÜŸáÿ± ŸÅŸä ÿßŸÑÿπÿßŸÑŸÖÿü',options_ar:['ÿßŸÑÿ£ŸÖÿßÿ≤ŸàŸÜ','ÿßŸÑŸÜŸäŸÑ','ÿßŸÑŸÖÿ≥Ÿäÿ≥Ÿäÿ®Ÿä','ÿßŸÑŸäÿßŸÜÿ∫ÿ™ÿ≥Ÿä'],correctIndex:1,category:'ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß'},
  {type:'mcq',question_ar:'ŸÖŸÜ ŸÖÿ§ŸÑŸÅ ŸÉÿ™ÿßÿ® ÿßŸÑŸÖŸÇÿØŸÖÿ©ÿü',options_ar:['ÿßÿ®ŸÜ ÿ≥ŸäŸÜÿß','ÿßÿ®ŸÜ ÿÆŸÑÿØŸàŸÜ','ÿßŸÑŸÅÿßÿ±ÿßÿ®Ÿä','ÿßÿ®ŸÜ ÿ±ÿ¥ÿØ'],correctIndex:1,category:'ÿ™ÿßÿ±ŸäÿÆ'},
  {type:'mcq',question_ar:'ŸÖÿß ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑÿ£ŸÉÿ´ÿ± ŸàŸÅÿ±ÿ© ŸÅŸä ÿßŸÑŸÉŸàŸÜÿü',options_ar:['ÿßŸÑÿ£ŸÉÿ≥ÿ¨ŸäŸÜ','ÿßŸÑŸáŸäÿØÿ±Ÿàÿ¨ŸäŸÜ','ÿßŸÑŸáŸäŸÑŸäŸàŸÖ','ÿßŸÑŸÉÿ±ÿ®ŸàŸÜ'],correctIndex:1,category:'ÿπŸÑŸàŸÖ'},
  {type:'mcq',question_ar:'ŸÖÿß ÿ£ŸÉÿ®ÿ± ÿØŸàŸÑÿ© ÿπÿ±ÿ®Ÿäÿ© ŸÖÿ≥ÿßÿ≠ÿ©ÿü',options_ar:['ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©','ÿßŸÑÿ¨ÿ≤ÿßÿ¶ÿ±','ŸÖÿµÿ±','ÿßŸÑÿ≥ŸàÿØÿßŸÜ'],correctIndex:1,category:'ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß'},
  {type:'mcq',question_ar:'ŸÉŸÖ ÿπÿØÿØ ÿ≥Ÿàÿ± ÿßŸÑŸÇÿ±ÿ¢ŸÜ ÿßŸÑŸÉÿ±ŸäŸÖÿü',options_ar:['Ÿ°Ÿ°Ÿ†','Ÿ°Ÿ°Ÿ§','Ÿ°Ÿ¢Ÿ†','Ÿ°Ÿ†Ÿ§'],correctIndex:1,category:'ÿ•ÿ≥ŸÑÿßŸÖŸäÿßÿ™'},
  {type:'mcq',question_ar:'ŸÖÿß ÿßŸÑÿØŸàŸÑÿ© ÿßŸÑŸÖÿ¥ÿ™Ÿáÿ±ÿ© ÿ®ÿßŸÑÿ£Ÿáÿ±ÿßŸÖÿßÿ™ÿü',options_ar:['ÿßŸÑÿπÿ±ÿßŸÇ','ŸÖÿµÿ±','ÿßŸÑŸÖŸÉÿ≥ŸäŸÉ','ÿßŸÑÿ≥ŸàÿØÿßŸÜ'],correctIndex:1,category:'ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß'},
  {type:'mcq',question_ar:'ŸÖÿß ÿßŸÑÿ∫ÿßÿ≤ ÿßŸÑÿ∞Ÿä ÿ™ŸÖÿ™ÿµŸá ÿßŸÑŸÜÿ®ÿßÿ™ÿßÿ™ÿü',options_ar:['ÿßŸÑÿ£ŸÉÿ≥ÿ¨ŸäŸÜ','ÿßŸÑŸÜŸäÿ™ÿ±Ÿàÿ¨ŸäŸÜ','ÿ´ÿßŸÜŸä ÿ£ŸÉÿ≥ŸäÿØ ÿßŸÑŸÉÿ±ÿ®ŸàŸÜ','ÿßŸÑŸáŸäÿØÿ±Ÿàÿ¨ŸäŸÜ'],correctIndex:2,category:'ÿπŸÑŸàŸÖ'},
  {type:'mcq',question_ar:'ŸÖŸÜ ÿßÿÆÿ™ÿ±ÿπ ÿßŸÑŸÖÿµÿ®ÿßÿ≠ ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿü',options_ar:['ÿ™ÿ≥ŸÑÿß','ÿ•ÿØŸäÿ≥ŸàŸÜ','ÿ£ŸäŸÜÿ¥ÿ™ÿßŸäŸÜ','ÿ®ŸäŸÑ'],correctIndex:1,category:'ÿπŸÑŸàŸÖ'},
  {type:'mcq',question_ar:'ŸÖÿß ÿ£ÿµÿ∫ÿ± ŸÇÿßÿ±ÿ© ŸÅŸä ÿßŸÑÿπÿßŸÑŸÖÿü',options_ar:['ÿ£Ÿàÿ±Ÿàÿ®ÿß','ÿ£ŸÅÿ±ŸäŸÇŸäÿß','ÿ£ÿ≥ÿ™ÿ±ÿßŸÑŸäÿß','ÿ£ŸÜÿ™ÿßÿ±ŸÉÿ™ŸäŸÉÿß'],correctIndex:2,category:'ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß'},
  {type:'mcq',question_ar:'ŸÉŸÖ ÿπÿØÿØ ÿ£ŸÑŸàÿßŸÜ ŸÇŸàÿ≥ ŸÇÿ≤ÿ≠ÿü',options_ar:['ÿÆŸÖÿ≥ÿ©','ÿ≥ÿ™ÿ©','ÿ≥ÿ®ÿπÿ©','ÿ´ŸÖÿßŸÜŸäÿ©'],correctIndex:2,category:'ÿπŸÑŸàŸÖ'},
  {type:'mcq',question_ar:'ŸÖÿß ÿ£ÿ≥ÿ±ÿπ ÿ≠ŸäŸàÿßŸÜ ÿ®ÿ±Ÿäÿü',options_ar:['ÿßŸÑÿ£ÿ≥ÿØ','ÿßŸÑŸÅŸáÿØ','ÿßŸÑÿ≠ÿµÿßŸÜ','ÿßŸÑÿ∫ÿ≤ÿßŸÑ'],correctIndex:1,category:'ÿ∑ÿ®Ÿäÿπÿ©'},
  {type:'mcq',question_ar:'ŸÖÿß ÿπŸÖŸÑÿ© ÿßŸÑŸäÿßÿ®ÿßŸÜÿü',options_ar:['ÿßŸÑŸäŸàÿßŸÜ','ÿßŸÑŸäŸÜ','ÿßŸÑŸàŸàŸÜ','ÿßŸÑÿ®ÿßŸáÿ™'],correctIndex:1,category:'ÿ´ŸÇÿßŸÅÿ© ÿπÿßŸÖÿ©'},
  {type:'mcq',question_ar:'ŸÉŸÖ ÿπÿØÿØ ÿ£ÿ≥ŸÜÿßŸÜ ÿßŸÑÿ•ŸÜÿ≥ÿßŸÜ ÿßŸÑÿ®ÿßŸÑÿ∫ÿü',options_ar:['Ÿ¢Ÿ®','Ÿ£Ÿ†','Ÿ£Ÿ¢','Ÿ£Ÿ§'],correctIndex:2,category:'ÿπŸÑŸàŸÖ'},
  {type:'mcq',question_ar:'ŸÖÿß ÿ£ŸÉÿ®ÿ± ŸÖÿ≠Ÿäÿ∑ ŸÅŸä ÿßŸÑÿπÿßŸÑŸÖÿü',options_ar:['ÿßŸÑÿ£ÿ∑ŸÑÿ≥Ÿä','ÿßŸÑŸáŸÜÿØŸä','ÿßŸÑŸáÿßÿØÿ¶','ÿßŸÑŸÖÿ™ÿ¨ŸÖÿØ'],correctIndex:2,category:'ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß'},
  {type:'mcq',question_ar:'ŸÖŸÜ ÿ£ŸàŸÑ ÿ±ÿßÿ¶ÿØ ŸÅÿ∂ÿßÿ°ÿü',options_ar:['ÿ£ÿ±ŸÖÿ≥ÿ™ÿ±ŸàŸÜÿ∫','ÿ∫ÿßÿ∫ÿßÿ±ŸäŸÜ','ÿ£ŸÑÿØÿ±ŸäŸÜ','ÿ∫ŸÑŸäŸÜ'],correctIndex:1,category:'ÿ™ÿßÿ±ŸäÿÆ'},
  {type:'mcq',question_ar:'ŸÖÿß ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ£ŸÉÿ´ÿ± ÿ™ÿ≠ÿØÿ´ÿßŸã ŸÅŸä ÿßŸÑÿπÿßŸÑŸÖÿü',options_ar:['ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ©','ÿßŸÑÿµŸäŸÜŸäÿ©','ÿßŸÑÿ•ÿ≥ÿ®ÿßŸÜŸäÿ©','ÿßŸÑÿπÿ±ÿ®Ÿäÿ©'],correctIndex:1,category:'ÿ´ŸÇÿßŸÅÿ© ÿπÿßŸÖÿ©'},
  {type:'mcq',question_ar:'ŸÅŸä ÿ£Ÿä ÿ®ÿ≠ÿ± ŸäŸÇÿπ ÿÆŸÑŸäÿ¨ ÿßŸÑÿπŸÇÿ®ÿ©ÿü',options_ar:['ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑','ÿßŸÑÿ£ÿ≠ŸÖÿ±','ÿ®ÿ≠ÿ± ÿßŸÑÿπÿ±ÿ®','ÿßŸÑÿÆŸÑŸäÿ¨ ÿßŸÑÿπÿ±ÿ®Ÿä'],correctIndex:1,category:'ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß'},
  {type:'mcq',question_ar:'ŸÅŸä ÿ£Ÿä ÿπÿßŸÖ ÿßŸÅÿ™ÿ™ÿ≠ÿ™ ŸÇŸÜÿßÿ© ÿßŸÑÿ≥ŸàŸäÿ≥ÿü',options_ar:['Ÿ°Ÿ®Ÿ•Ÿ©','Ÿ°Ÿ®Ÿ¶Ÿ©','Ÿ°Ÿ®ŸßŸ©','Ÿ°Ÿ®Ÿ§Ÿ©'],correctIndex:1,category:'ÿ™ÿßÿ±ŸäÿÆ'},
  {type:'mcq',question_ar:'ŸÖÿß ÿπÿßÿµŸÖÿ© ŸÅÿ±ŸÜÿ≥ÿßÿü',options_ar:['ŸÑŸäŸàŸÜ','ÿ®ÿßÿ±Ÿäÿ≥','ŸÖÿßÿ±ÿ≥ŸäŸÑŸäÿß','ŸÜŸäÿ≥'],correctIndex:1,category:'ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß'},
  {type:'mcq',question_ar:'ŸÉŸÖ ÿπÿØÿØ ÿßŸÑŸÉŸàÿßŸÉÿ® ŸÅŸä ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑÿ¥ŸÖÿ≥Ÿäÿ©ÿü',options_ar:['ÿ≥ÿ®ÿπÿ©','ÿ´ŸÖÿßŸÜŸäÿ©','ÿ™ÿ≥ÿπÿ©','ÿπÿ¥ÿ±ÿ©'],correctIndex:1,category:'ÿπŸÑŸàŸÖ'},
  {type:'mcq',question_ar:'ŸÖŸÜ ÿ®ŸÜŸâ ÿßŸÑÿ£Ÿáÿ±ÿßŸÖÿßÿ™ÿü',options_ar:['ÿßŸÑÿ±ŸàŸÖÿßŸÜ','ÿßŸÑŸÅÿ±ÿßÿπŸÜÿ©','ÿßŸÑÿ•ÿ∫ÿ±ŸäŸÇ','ÿßŸÑŸÅŸäŸÜŸäŸÇŸäŸàŸÜ'],correctIndex:1,category:'ÿ™ÿßÿ±ŸäÿÆ'},
  {type:'mcq',question_ar:'ŸÖÿß ÿ£ŸÉÿ®ÿ± ÿ≠ŸäŸàÿßŸÜ ÿπŸÑŸâ ÿßŸÑÿ£ÿ±ÿ∂ÿü',options_ar:['ÿßŸÑŸÅŸäŸÑ','ÿßŸÑÿ≠Ÿàÿ™ ÿßŸÑÿ£ÿ≤ÿ±ŸÇ','ÿßŸÑÿ≤ÿ±ÿßŸÅÿ©','Ÿàÿ≠ŸäÿØ ÿßŸÑŸÇÿ±ŸÜ'],correctIndex:1,category:'ÿ∑ÿ®Ÿäÿπÿ©'},
  {type:'mcq',question_ar:'ŸÉŸÖ ÿπÿØÿØ ÿ£ÿ≠ÿ±ŸÅ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ©ÿü',options_ar:['Ÿ¢Ÿ¶','Ÿ¢Ÿ®','Ÿ£Ÿ†','Ÿ£Ÿ¢'],correctIndex:1,category:'ÿ´ŸÇÿßŸÅÿ© ÿπÿßŸÖÿ©'},
  {type:'mcq',question_ar:'ŸÖÿß ÿ£ÿµŸÑÿ® ŸÖÿßÿØÿ© ÿ∑ÿ®ŸäÿπŸäÿ©ÿü',options_ar:['ÿßŸÑÿ≠ÿØŸäÿØ','ÿßŸÑÿ£ŸÑŸÖÿßÿ≥','ÿßŸÑÿ∞Ÿáÿ®','ÿßŸÑŸÉŸàÿßÿ±ÿ™ÿ≤'],correctIndex:1,category:'ÿπŸÑŸàŸÖ'},
  {type:'mcq',question_ar:'ŸÖÿß ÿπÿßÿµŸÖÿ© ÿ™ÿ±ŸÉŸäÿßÿü',options_ar:['ÿ•ÿ≥ÿ∑ŸÜÿ®ŸàŸÑ','ÿ£ŸÜŸÇÿ±ÿ©','ÿ£ŸÜÿ∑ÿßŸÑŸäÿß','ÿ®Ÿàÿ±ÿµÿ©'],correctIndex:1,category:'ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß'},
  {type:'mcq',question_ar:'ŸÉŸÖ ÿπÿØÿØ ÿ£ŸäÿßŸÖ ÿßŸÑÿ≥ŸÜÿ© ÿßŸÑŸÖŸäŸÑÿßÿØŸäÿ©ÿü',options_ar:['Ÿ£Ÿ¶Ÿ†','Ÿ£Ÿ¶Ÿ•','Ÿ£ŸßŸ†','Ÿ£Ÿ•Ÿ§'],correctIndex:1,category:'ÿ´ŸÇÿßŸÅÿ© ÿπÿßŸÖÿ©'},
  {type:'mcq',question_ar:'ŸÖÿß ÿ£ÿ∑ŸàŸÑ ÿ≥Ÿàÿ±ÿ© ŸÅŸä ÿßŸÑŸÇÿ±ÿ¢ŸÜÿü',options_ar:['ÿ¢ŸÑ ÿπŸÖÿ±ÿßŸÜ','ÿßŸÑÿ®ŸÇÿ±ÿ©','ÿßŸÑŸÜÿ≥ÿßÿ°','ÿßŸÑŸÖÿßÿ¶ÿØÿ©'],correctIndex:1,category:'ÿ•ÿ≥ŸÑÿßŸÖŸäÿßÿ™'},
  {type:'mcq',question_ar:'ŸÅŸä ÿ£Ÿä ŸÇÿßÿ±ÿ© ÿ™ŸÇÿπ ÿßŸÑÿ®ÿ±ÿßÿ≤ŸäŸÑÿü',options_ar:['ÿ£ŸÅÿ±ŸäŸÇŸäÿß','ÿ£ŸÖÿ±ŸäŸÉÿß ÿßŸÑÿ¨ŸÜŸàÿ®Ÿäÿ©','ÿ£Ÿàÿ±Ÿàÿ®ÿß','ÿ¢ÿ≥Ÿäÿß'],correctIndex:1,category:'ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß'},
  {type:'mcq',question_ar:'ŸÖÿß ŸÑŸàŸÜ ÿßŸÑÿØŸÖ ŸÅŸä ÿßŸÑÿ£Ÿàÿ±ÿØÿ©ÿü',options_ar:['ÿ£ÿ≠ŸÖÿ± ŸÅÿßÿ™ÿ≠','ÿ£ÿ≠ŸÖÿ± ÿ∫ÿßŸÖŸÇ','ÿ£ÿ≤ÿ±ŸÇ','ÿ®ŸÜŸÅÿ≥ÿ¨Ÿä'],correctIndex:1,category:'ÿπŸÑŸàŸÖ'},
  {type:'mcq',question_ar:'ŸÖŸÜ ŸáŸà ÿÆÿßÿ™ŸÖ ÿßŸÑÿ£ŸÜÿ®Ÿäÿßÿ°ÿü',options_ar:['ÿπŸäÿ≥Ÿâ','ŸÖÿ≠ŸÖÿØ Ô∑∫','ÿ•ÿ®ÿ±ÿßŸáŸäŸÖ','ŸÖŸàÿ≥Ÿâ'],correctIndex:1,category:'ÿ•ÿ≥ŸÑÿßŸÖŸäÿßÿ™'},
  {type:'mcq',question_ar:'ŸÖÿß ÿ£ŸÉÿ®ÿ± ÿµÿ≠ÿ±ÿßÿ° ŸÅŸä ÿßŸÑÿπÿßŸÑŸÖÿü',options_ar:['ÿ¨Ÿàÿ®Ÿä','ÿßŸÑÿµÿ≠ÿ±ÿßÿ° ÿßŸÑŸÉÿ®ÿ±Ÿâ','ÿßŸÑÿ±ÿ®ÿπ ÿßŸÑÿÆÿßŸÑŸä','ŸÉÿßŸÑÿßŸáÿßÿ±Ÿä'],correctIndex:1,category:'ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß'},
  {type:'mcq',question_ar:'ŸÉŸÖ ÿ±ŸÉÿπÿ© ŸÅŸä ÿµŸÑÿßÿ© ÿßŸÑÿ∏Ÿáÿ±ÿü',options_ar:['ÿ±ŸÉÿπÿ™ÿßŸÜ','ÿ´ŸÑÿßÿ´','ÿ£ÿ±ÿ®ÿπ','ÿÆŸÖÿ≥'],correctIndex:2,category:'ÿ•ÿ≥ŸÑÿßŸÖŸäÿßÿ™'},
  {type:'mcq',question_ar:'ŸÖÿß ÿßŸÑŸÖÿπÿØŸÜ ÿßŸÑÿ£ŸÉÿ´ÿ± ÿ™ŸàÿµŸäŸÑÿßŸã ŸÑŸÑŸÉŸáÿ±ÿ®ÿßÿ°ÿü',options_ar:['ÿßŸÑÿ∞Ÿáÿ®','ÿßŸÑŸÅÿ∂ÿ©','ÿßŸÑŸÜÿ≠ÿßÿ≥','ÿßŸÑÿ£ŸÑŸÖŸÜŸäŸàŸÖ'],correctIndex:1,category:'ÿπŸÑŸàŸÖ'},
  {type:'mcq',question_ar:'ŸÖÿß ÿ£ÿµÿ∫ÿ± ÿØŸàŸÑÿ© ŸÅŸä ÿßŸÑÿπÿßŸÑŸÖÿü',options_ar:['ŸÖŸàŸÜÿßŸÉŸà','ÿßŸÑŸÅÿßÿ™ŸäŸÉÿßŸÜ','ÿ≥ÿßŸÜ ŸÖÿßÿ±ŸäŸÜŸà','ŸÑŸàŸÉÿ≥ŸÖÿ®Ÿàÿ±ÿ∫'],correctIndex:1,category:'ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß'},
  {type:'mcq',question_ar:'ŸÖÿß ÿßŸÑÿ≠ŸäŸàÿßŸÜ ÿßŸÑŸàÿ∑ŸÜŸä ŸÑÿ£ÿ≥ÿ™ÿ±ÿßŸÑŸäÿßÿü',options_ar:['ÿßŸÑŸÉŸàÿßŸÑÿß','ÿßŸÑŸÉŸÜÿ∫ÿ±','ÿßŸÑÿ®ŸÑÿßÿ™Ÿäÿ®Ÿàÿ≥','ÿßŸÑÿ•ŸäŸÖŸà'],correctIndex:1,category:'ÿ∑ÿ®Ÿäÿπÿ©'},
  {type:'mcq',question_ar:'ŸÖÿß ÿßŸÑŸÉŸàŸÉÿ® ÿßŸÑÿ£ŸÇÿ±ÿ® ŸÑŸÑÿ¥ŸÖÿ≥ÿü',options_ar:['ÿßŸÑÿ≤Ÿáÿ±ÿ©','ÿπÿ∑ÿßÿ±ÿØ','ÿßŸÑŸÖÿ±ŸäÿÆ','ÿßŸÑÿ£ÿ±ÿ∂'],correctIndex:1,category:'ÿπŸÑŸàŸÖ'},
  {type:'mcq',question_ar:'ÿ£ŸäŸÜ ŸäŸÇÿπ ÿ®ÿ±ÿ¨ ÿ•ŸäŸÅŸÑÿü',options_ar:['ŸÑŸÜÿØŸÜ','ÿ®ÿßÿ±Ÿäÿ≥','ÿ±ŸàŸÖÿß','ÿ®ÿ±ŸÑŸäŸÜ'],correctIndex:1,category:'ÿ´ŸÇÿßŸÅÿ© ÿπÿßŸÖÿ©'},
  {type:'mcq',question_ar:'ŸÉŸÖ ÿπÿØÿØ ÿ£ÿ±ÿ¨ŸÑ ÿßŸÑÿπŸÜŸÉÿ®Ÿàÿ™ÿü',options_ar:['Ÿ¶','Ÿ®','Ÿ°Ÿ†','Ÿ°Ÿ¢'],correctIndex:1,category:'ÿ∑ÿ®Ÿäÿπÿ©'},
  {type:'mcq',question_ar:'ŸÖÿß ÿ£ŸÇÿØŸÖ ÿ≠ÿ∂ÿßÿ±ÿ© ŸÅŸä ÿßŸÑÿ™ÿßÿ±ŸäÿÆÿü',options_ar:['ÿßŸÑŸÖÿµÿ±Ÿäÿ©','ÿßŸÑÿ≥ŸàŸÖÿ±Ÿäÿ©','ÿßŸÑÿµŸäŸÜŸäÿ©','ÿßŸÑŸáŸÜÿØŸäÿ©'],correctIndex:1,category:'ÿ™ÿßÿ±ŸäÿÆ'},
  {type:'mcq',question_ar:'ŸÖÿß ÿπÿßÿµŸÖÿ© ÿßŸÑŸäÿßÿ®ÿßŸÜÿü',options_ar:['ÿ£Ÿàÿ≥ÿßŸÉÿß','ÿ∑ŸàŸÉŸäŸà','ŸÉŸäŸàÿ™Ÿà','ŸäŸàŸÉŸàŸáÿßŸÖÿß'],correctIndex:1,category:'ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß'},
  {type:'mcq',question_ar:'ŸÖŸÜ ÿßŸÉÿ™ÿ¥ŸÅ ÿ£ŸÖÿ±ŸäŸÉÿßÿü',options_ar:['ŸÖÿßÿ¨ŸÑÿßŸÜ','ŸÉŸàŸÑŸàŸÖÿ®Ÿàÿ≥','ŸÉŸàŸÉ','ŸÅÿßÿ≥ŸÉŸà ÿØŸä ÿ∫ÿßŸÖÿß'],correctIndex:1,category:'ÿ™ÿßÿ±ŸäÿÆ'},
  {type:'mcq',question_ar:'ŸÉŸÖ ÿπÿØÿØ ÿ£ÿ∂ŸÑÿßÿπ ÿßŸÑŸÖÿ´ŸÑÿ´ÿü',options_ar:['ÿßÿ´ŸÜÿßŸÜ','ÿ´ŸÑÿßÿ´ÿ©','ÿ£ÿ±ÿ®ÿπÿ©','ÿÆŸÖÿ≥ÿ©'],correctIndex:1,category:'ÿπŸÑŸàŸÖ'},
  {type:'mcq',question_ar:'ŸÖÿß ÿπÿßÿµŸÖÿ© ÿ•ÿ≥ÿ®ÿßŸÜŸäÿßÿü',options_ar:['ÿ®ÿ±ÿ¥ŸÑŸàŸÜÿ©','ŸÖÿØÿ±ŸäÿØ','ÿ•ÿ¥ÿ®ŸäŸÑŸäÿ©','ŸÅÿßŸÑŸÜÿ≥Ÿäÿß'],correctIndex:1,category:'ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß'},
  {type:'mcq',question_ar:'ŸÖÿß ŸÑÿ∫ÿ© ÿßŸÑÿ®ÿ±ŸÖÿ¨ÿ© ÿßŸÑÿ£ŸÉÿ´ÿ± ÿßÿ≥ÿ™ÿÆÿØÿßŸÖÿßŸãÿü',options_ar:['ÿ®ÿßŸäÿ´ŸàŸÜ','ÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™','ÿ¨ÿßŸÅÿß','ÿ≥Ÿä++'],correctIndex:1,category:'ÿ™ŸÇŸÜŸäÿ©'},
  {type:'mcq',question_ar:'ŸÖŸÜ ÿ±ÿ≥ŸÖ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸàŸÜÿßŸÑŸäÿ≤ÿßÿü',options_ar:['ÿ®ŸäŸÉÿßÿ≥Ÿà','ÿØÿß ŸÅŸäŸÜÿ¥Ÿä','ŸÖÿßŸäŸÉŸÑ ÿ£ŸÜÿ¨ŸÑŸà','ÿ±ŸÖÿ®ÿ±ÿßŸÜÿ™'],correctIndex:1,category:'ŸÅŸÜŸàŸÜ'},
  {type:'mcq',question_ar:'ŸÉŸÖ ÿπÿØÿØ ŸÑÿßÿπÿ®Ÿä ŸÅÿ±ŸäŸÇ ŸÉÿ±ÿ© ÿßŸÑŸÇÿØŸÖÿü',options_ar:['Ÿ©','Ÿ°Ÿ†','Ÿ°Ÿ°','Ÿ°Ÿ¢'],correctIndex:2,category:'ÿ±Ÿäÿßÿ∂ÿ©'},
  {type:'mcq',question_ar:'ŸÖÿß ÿ£ÿπŸÑŸâ ŸÇŸÖÿ© ŸÅŸä ÿßŸÑÿπÿßŸÑŸÖÿü',options_ar:['ŸÉŸÑŸÖŸÜÿ¨ÿßÿ±Ÿà','ÿ•ŸäŸÅÿ±ÿ≥ÿ™','ŸÖŸàŸÜ ÿ®ŸÑÿßŸÜ','ÿ£ŸÉŸàŸÜŸÉÿßÿ∫Ÿàÿß'],correctIndex:1,category:'ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß'},
  {type:'mcq',question_ar:'ŸÖÿß ÿßŸÑÿπŸÖŸÑÿ© ÿßŸÑÿ±ÿ≥ŸÖŸäÿ© ŸÑÿ®ÿ±Ÿäÿ∑ÿßŸÜŸäÿßÿü',options_ar:['ÿßŸÑŸäŸàÿ±Ÿà','ÿßŸÑÿ¨ŸÜŸäŸá ÿßŸÑÿ•ÿ≥ÿ™ÿ±ŸÑŸäŸÜŸä','ÿßŸÑÿØŸàŸÑÿßÿ±','ÿßŸÑŸÅÿ±ŸÜŸÉ'],correctIndex:1,category:'ÿ´ŸÇÿßŸÅÿ© ÿπÿßŸÖÿ©'},
  {type:'mcq',question_ar:'ŸÖÿß ÿ£ŸàŸÑ ÿ≥Ÿàÿ±ÿ© ŸÜÿ≤ŸÑÿ™ ŸÅŸä ÿßŸÑŸÇÿ±ÿ¢ŸÜÿü',options_ar:['ÿßŸÑŸÅÿßÿ™ÿ≠ÿ©','ÿßŸÑÿπŸÑŸÇ','ÿßŸÑŸÖÿØÿ´ÿ±','ÿßŸÑŸÇŸÑŸÖ'],correctIndex:1,category:'ÿ•ÿ≥ŸÑÿßŸÖŸäÿßÿ™'},
  {type:'mcq',question_ar:'ŸÖÿß ÿßŸÑŸÅŸäÿ™ÿßŸÖŸäŸÜ ÿßŸÑÿ∞Ÿä Ÿäÿ£ÿ™Ÿä ŸÖŸÜ ÿßŸÑÿ¥ŸÖÿ≥ÿü',options_ar:['ŸÅŸäÿ™ÿßŸÖŸäŸÜ ÿ£','ŸÅŸäÿ™ÿßŸÖŸäŸÜ ÿØ','ŸÅŸäÿ™ÿßŸÖŸäŸÜ ÿ≥Ÿä','ŸÅŸäÿ™ÿßŸÖŸäŸÜ ÿ®'],correctIndex:1,category:'ÿµÿ≠ÿ©'},
  {type:'mcq',question_ar:'ŸÖÿß ÿßŸÑÿ≠ŸäŸàÿßŸÜ ÿßŸÑŸÖŸÑŸÇÿ® ÿ®ÿ≥ŸÅŸäŸÜÿ© ÿßŸÑÿµÿ≠ÿ±ÿßÿ°ÿü',options_ar:['ÿßŸÑÿ≠ÿµÿßŸÜ','ÿßŸÑÿ¨ŸÖŸÑ','ÿßŸÑÿ≠ŸÖÿßÿ±','ÿßŸÑÿ®ÿ∫ŸÑ'],correctIndex:1,category:'ÿ∑ÿ®Ÿäÿπÿ©'},
  {type:'mcq',question_ar:'ŸÖŸÜ ŸÖÿ§ÿ≥ÿ≥ ÿ¥ÿ±ŸÉÿ© ŸÖÿßŸäŸÉÿ±Ÿàÿ≥ŸàŸÅÿ™ÿü',options_ar:['ÿ≥ÿ™ŸäŸÅ ÿ¨Ÿàÿ®ÿ≤','ÿ®ŸäŸÑ ÿ∫Ÿäÿ™ÿ≥','ŸÖÿßÿ±ŸÉ ÿ≤ŸàŸÉÿ±ÿ®Ÿäÿ±ÿ∫','ÿ•ŸäŸÑŸàŸÜ ŸÖÿßÿ≥ŸÉ'],correctIndex:1,category:'ÿ™ŸÇŸÜŸäÿ©'},
  {type:'mcq',question_ar:'ŸÖÿß ÿ£ÿ∑ŸàŸÑ ŸÜŸáÿ± ŸÅŸä ÿ¢ÿ≥Ÿäÿßÿü',options_ar:['ÿßŸÑÿ∫ÿßŸÜÿ¨','ÿßŸÑŸäÿßŸÜÿ∫ÿ™ÿ≥Ÿä','ŸÖŸäŸÉŸàŸÜÿ∫','ÿØÿ¨ŸÑÿ©'],correctIndex:1,category:'ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß'},
  {type:'mcq',question_ar:'ŸÉŸÖ ŸÖÿ±ÿ© ŸÅÿßÿ≤ÿ™ ÿßŸÑÿ®ÿ±ÿßÿ≤ŸäŸÑ ÿ®ŸÉÿ£ÿ≥ ÿßŸÑÿπÿßŸÑŸÖÿü',options_ar:['Ÿ£','Ÿ§','Ÿ•','Ÿ¶'],correctIndex:2,category:'ÿ±Ÿäÿßÿ∂ÿ©'},
  {type:'mcq',question_ar:'ŸÖÿß ÿßŸÑÿ∫ÿßÿ≤ ÿßŸÑÿ∂ÿ±Ÿàÿ±Ÿä ŸÑŸÑÿ™ŸÜŸÅÿ≥ÿü',options_ar:['ÿßŸÑŸÜŸäÿ™ÿ±Ÿàÿ¨ŸäŸÜ','ÿßŸÑÿ£ŸÉÿ≥ÿ¨ŸäŸÜ','ÿ´ÿßŸÜŸä ÿ£ŸÉÿ≥ŸäÿØ ÿßŸÑŸÉÿ±ÿ®ŸàŸÜ','ÿßŸÑŸáŸäÿØÿ±Ÿàÿ¨ŸäŸÜ'],correctIndex:1,category:'ÿπŸÑŸàŸÖ'},
  {type:'mcq',question_ar:'ŸÖŸÜ ÿ®ŸÜŸâ ŸÖÿØŸäŸÜÿ© ÿ®ÿ∫ÿØÿßÿØÿü',options_ar:['Ÿáÿßÿ±ŸàŸÜ ÿßŸÑÿ±ÿ¥ŸäÿØ','ÿßŸÑŸÖŸÜÿµŸàÿ±','ÿßŸÑŸÖÿ£ŸÖŸàŸÜ','ÿßŸÑŸÖÿπÿ™ÿµŸÖ'],correctIndex:1,category:'ÿ™ÿßÿ±ŸäÿÆ'},
  {type:'mcq',question_ar:'ŸÖÿß ÿ£ŸÉÿ®ÿ± ŸÉŸàŸÉÿ® ŸÅŸä ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑÿ¥ŸÖÿ≥Ÿäÿ©ÿü',options_ar:['ÿ≤ÿ≠ŸÑ','ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿä','ÿ£Ÿàÿ±ÿßŸÜŸàÿ≥','ŸÜÿ®ÿ™ŸàŸÜ'],correctIndex:1,category:'ÿπŸÑŸàŸÖ'},
  {type:'mcq',question_ar:'ŸÖŸÜ ŸÖÿÆÿ™ÿ±ÿπ ÿßŸÑŸáÿßÿ™ŸÅÿü',options_ar:['ÿ•ÿØŸäÿ≥ŸàŸÜ','ÿ∫ÿ±ÿßŸáÿßŸÖ ÿ®ŸäŸÑ','ŸÖÿßÿ±ŸÉŸàŸÜŸä','ÿ™ÿ≥ŸÑÿß'],correctIndex:1,category:'ÿ™ÿßÿ±ŸäÿÆ'},
];

/* ============================================
   APP CONTROLLER
   ============================================ */
const App = {
  /* ---- Welcome ---- */
  buildTeamInputs() {
    const n = parseInt($('numTeamsSelect').value);
    G.numTeams = n;
    let html = '';
    for (let i = 0; i < n; i++) {
      html += `<div class="field">
        <label><span class="team-dot td${i}"></span> ÿßÿ≥ŸÖ ÿßŸÑŸÅÿ±ŸäŸÇ ${toAr(i + 1)}</label>
        <input type="text" id="tInp${i}" class="input" placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÅÿ±ŸäŸÇ..." maxlength="20">
      </div>`;
    }
    $('teamInputsArea').innerHTML = html;
  },

  async goCategories() {
    const n = parseInt($('numTeamsSelect').value);
    const numCats = parseInt($('numCatsSelect').value);

    const names = [];
    for (let i = 0; i < n; i++) {
      const inp = $(`tInp${i}`);
      if (!inp) { $('welErr').textContent = 'ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨'; return; }
      const v = inp.value.trim();
      if (!v) { $('welErr').textContent = 'ÿ£ÿØÿÆŸÑ ÿ¨ŸÖŸäÿπ ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑŸÅÿ±ŸÇ'; return; }
      names.push(v);
    }
    $('welErr').textContent = '';

    resetG();
    G.numTeams = n;
    G.numCats = numCats;
    for (let i = 0; i < n; i++) {
      G.teams.push({ name: names[i], score: 0, color: TEAM_COLORS[i % TEAM_COLORS.length] });
      G.lifelines.push({ call: true, double: true, hole: true, rest: true });
      G.teamPicks.push([]);
    }

    toast('info', 'ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©...');
    let raw = await loadQuestions();
    if (!raw) raw = FALLBACK_RAW;
    G.allCategories = buildCategories(raw);

    if (G.allCategories.length < numCats) {
      toast('fail', `ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÅÿ¶ÿßÿ™ ŸÉÿßŸÅŸäÿ© (${toAr(G.allCategories.length)} ŸÅŸÇÿ∑)`);
      return;
    }

    $('catHeaderSub').textContent = `ŸÉŸÑ ŸÅÿ±ŸäŸÇ ŸäÿÆÿ™ÿßÿ± ŸÅÿ¶ÿßÿ™Ÿá ‚Äî ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ${toAr(numCats)} ŸÅÿ¶ÿßÿ™`;
    G.pickTurn = 0;
    showScreen('catScreen');
    this._renderCatSelection();
  },

  /* ---- Category Selection ---- */
  _getPicksNeeded(t) {
    const base = Math.floor(G.numCats / G.numTeams);
    const rem = G.numCats % G.numTeams;
    return base + (t < rem ? 1 : 0);
  },
  _allPicksDone() {
    let total = 0;
    for (let i = 0; i < G.numTeams; i++) total += G.teamPicks[i].length;
    return total >= G.numCats;
  },
  _currentTeamDone() {
    return G.teamPicks[G.pickTurn].length >= this._getPicksNeeded(G.pickTurn);
  },
  _advancePickTurn() {
    for (let s = 1; s <= G.numTeams; s++) {
      const next = (G.pickTurn + s) % G.numTeams;
      if (G.teamPicks[next].length < this._getPicksNeeded(next)) {
        G.pickTurn = next;
        return;
      }
    }
  },

  _renderCatSelection() {
    const allPicked = new Set(G.teamPicks.flat());
    const done = this._allPicksDone();

    if (!done) {
      const team = G.teams[G.pickTurn];
      const rem = this._getPicksNeeded(G.pickTurn) - G.teamPicks[G.pickTurn].length;
      $('catTurn').innerHTML = `<i class="fas fa-hand-pointer"></i> ${team.name} ‚Äî ÿßÿÆÿ™ÿ± ${toAr(rem)} ${rem === 1 ? 'ŸÅÿ¶ÿ©' : 'ŸÅÿ¶ÿßÿ™'}`;
      $('catTurn').style.background = `${team.color}18`;
      $('catTurn').style.color = team.color;
    } else {
      $('catTurn').innerHTML = '<i class="fas fa-check-circle"></i> ÿßŸÉÿ™ŸÖŸÑ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±!';
      $('catTurn').style.background = 'rgba(68,161,148,.1)';
      $('catTurn').style.color = 'var(--accent)';
    }

    $('catGrid').innerHTML = G.allCategories.map((c, i) => {
      const picked = allPicked.has(i);
      return `<div class="cat-card${picked ? ' picked' : ''}" onclick="App.pickCat(${i})">
        <span class="cat-icon">${c.icon}</span>
        ${c.name}
        <div class="cat-count">${toAr(c.questions.length)} ÿ£ÿ≥ÿ¶ŸÑÿ©</div>
      </div>`;
    }).join('');

    let selHTML = '';
    for (let t = 0; t < G.numTeams; t++) {
      if (G.teamPicks[t].length) {
        const team = G.teams[t];
        selHTML += `<div class="cat-sel-group">
          <h4 style="color:${team.color}">${team.name}</h4>
          <div class="chips">${G.teamPicks[t].map(i =>
            `<span class="chip" style="background:${team.color}18;color:${team.color}">${G.allCategories[i].name}</span>`
          ).join('')}</div>
        </div>`;
      }
    }
    $('catSelected').innerHTML = selHTML;
    $('catStartBtn').disabled = !done;
  },

  pickCat(idx) {
    if (this._allPicksDone()) return;
    if (new Set(G.teamPicks.flat()).has(idx)) return;
    if (this._currentTeamDone()) return;
    G.teamPicks[G.pickTurn].push(idx);
    if (this._currentTeamDone()) this._advancePickTurn();
    this._renderCatSelection();
  },

  /* ---- Game Board ---- */
  startBoard() {
    G.chosenCats = G.teamPicks.flat().map(i => G.allCategories[i]);
    G.totalCells = G.chosenCats.length * Q_PER_CAT;
    G.answeredCount = 0;
    G.turn = 0;
    showScreen('boardScreen');
    this._renderBoard();
    this._renderLifelines();
  },

  _renderBoard() {
    const numCols = G.chosenCats.length;
    const grid = $('boardGrid');
    grid.style.gridTemplateColumns = `repeat(${numCols}, 1fr)`;

    let html = '';
    G.chosenCats.forEach(c => {
      html += `<div class="board-col-header">${c.icon} ${c.name}</div>`;
    });
    for (let row = 0; row < Q_PER_CAT; row++) {
      const pts = POINT_TIERS[row];
      for (let col = 0; col < numCols; col++) {
        const key = `${col}-${row}`;
        const used = G.boardUsed.has(key);
        html += `<div class="board-cell ${used ? 'used' : 'pts-' + pts}" data-key="${key}" onclick="App.openQuestion(${col},${row})">
          ${used ? '<i class="fas fa-check"></i>' : toAr(pts)}
        </div>`;
      }
    }
    grid.innerHTML = html;
    this._updateTopBar();
  },

  _updateTopBar() {
    const team = G.teams[G.turn];
    let html = '';
    for (let t = 0; t < G.numTeams; t++) {
      const tm = G.teams[t];
      const isActive = t === G.turn;
      // Dynamic glow color via CSS variable
      const glowStyle = isActive
        ? `--glow-color:${tm.color}60;border-color:${tm.color};`
        : '';
      html += `<div class="ts-box${isActive ? ' active-t' : ''}" style="${glowStyle}">
        <span class="ts-dot" style="background:${tm.color}"></span>
        <div>
          <div class="ts-name">${tm.name}</div>
          <div class="ts-score" style="color:${tm.color}">${toAr(tm.score)}</div>
        </div>
      </div>`;
    }
    // Turn badge with dynamic team color
    html += `<div class="turn-badge" style="background:${team.color}"><i class="fas fa-gamepad"></i> ÿØŸàÿ±: ${team.name}</div>`;
    $('boardTop').innerHTML = html;
  },

  _renderLifelines() {
    let html = '';
    for (let t = 0; t < G.numTeams; t++) {
      const ll = G.lifelines[t];
      const team = G.teams[t];
      html += `<div class="ll-group">
        <span class="ll-label" style="color:${team.color}">${team.name}</span>
        <button class="ll-btn" title="ÿßÿ™ÿµÿßŸÑ ÿ®ÿµÿØŸäŸÇ" onclick="App.useLL(${t},'call')" ${!ll.call?'disabled':''}><i class="fas fa-phone"></i></button>
        <button class="ll-btn" title="ÿ¨ÿßŸàÿ® ÿ¨Ÿàÿßÿ®ŸäŸÜ" onclick="App.useLL(${t},'double')" ${!ll.double?'disabled':''}><i class="fas fa-clone"></i></button>
        <button class="ll-btn" title="ÿßŸÑÿ≠ŸÅÿ±ÿ©" onclick="App.useLL(${t},'hole')" ${!ll.hole?'disabled':''}><i class="fas fa-bomb"></i></button>
        <button class="ll-btn" title="ÿßÿ≥ÿ™ÿ±Ÿäÿ≠" onclick="App.useLL(${t},'rest')" ${!ll.rest?'disabled':''} style="color:#9b59b6"><i class="fas fa-couch"></i></button>
      </div>`;
    }
    $('llRow').innerHTML = html;
  },

  useLL(team, type) {
    if (team !== G.turn) { toast('fail', 'ŸÑŸäÿ≥ ÿØŸàÿ±ŸÉ!'); return; }
    if (!G.lifelines[team][type]) return;

    G.lifelines[team][type] = false;

    if (type === 'call') {
      G.activeCall = true;
      toast('ok', 'ÿßÿ™ÿµÿßŸÑ ÿ®ÿµÿØŸäŸÇ! Ÿ£Ÿ† ÿ´ÿßŸÜŸäÿ© ÿ•ÿ∂ÿßŸÅŸäÿ©');
    } else if (type === 'double') {
      G.activeDouble = true;
      G.doubleUsed = false;
      toast('info', 'ÿ¨ÿßŸàÿ® ÿ¨Ÿàÿßÿ®ŸäŸÜ! ŸÑÿØŸäŸÉ ŸÅÿ±ÿµÿ™ÿßŸÜ');
    } else if (type === 'hole') {
      G.activeHole = true;
      toast('info', 'ÿßŸÑÿ≠ŸÅÿ±ÿ© ŸÖŸÅÿπŸëŸÑÿ©! ÿßŸÑŸÜŸÇÿßÿ∑ ÿ™ŸèÿÆÿµŸÖ ŸÖŸÜ ÿßŸÑÿÆÿµŸÖ');
    } else if (type === 'rest') {
      // Show rest target selection
      this._showRestPicker(team);
      this._renderLifelines();
      return;
    }

    this._renderLifelines();
  },

  /* ---- Rest Lifeline: pick opponent to bench ---- */
  _showRestPicker(activatingTeam) {
    let html = `<h3><i class="fas fa-couch"></i> ÿßÿ≥ÿ™ÿ±Ÿäÿ≠</h3>
      <p>ÿßÿÆÿ™ÿ± ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ∞Ÿä ÿ≥Ÿäÿ≥ÿ™ÿ±Ÿäÿ≠ ŸÑÿßÿπÿ®Ÿá ÿßŸÑŸÖŸÖŸäÿ≤ ŸÅŸä ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑŸÇÿßÿØŸÖ</p>`;
    for (let t = 0; t < G.numTeams; t++) {
      if (t === activatingTeam) continue;
      html += `<button class="btn btn-secondary btn-sm" style="margin:4px;background:${G.teams[t].color}" onclick="App.confirmRest(${t})">
        ${G.teams[t].name}
      </button>`;
    }
    html += `<br><button class="btn btn-outline btn-sm" style="margin-top:12px" onclick="App.cancelRest(${activatingTeam})">ÿ•ŸÑÿ∫ÿßÿ°</button>`;
    $('restBox').innerHTML = html;
    $('restModal').classList.add('show');
  },

  confirmRest(targetTeam) {
    G.activeRest = true;
    G.restTarget = targetTeam;
    $('restModal').classList.remove('show');
    toast('info', `${G.teams[targetTeam].name} ‚Äî ŸÑÿßÿπÿ®ŸáŸÖ ÿßŸÑŸÖŸÖŸäÿ≤ Ÿäÿ≥ÿ™ÿ±Ÿäÿ≠ Ÿáÿ∞ÿß ÿßŸÑÿ≥ÿ§ÿßŸÑ!`);
  },

  cancelRest(activatingTeam) {
    // Give the lifeline back
    G.lifelines[activatingTeam].rest = true;
    $('restModal').classList.remove('show');
    this._renderLifelines();
  },

  /* ---- Question Modal ---- */
  openQuestion(col, row) {
    const key = `${col}-${row}`;
    if (G.boardUsed.has(key)) return;

    const cat = G.chosenCats[col];
    const q = cat.questions[row];
    const pts = POINT_TIERS[row];

    G.currentQ = q;
    G.currentCell = key;
    G.currentPts = pts;
    G.locked = false;

    const totalTime = BASE_TIME + (G.activeCall ? CALL_EXTRA : 0);

    let llInfo = '';
    if (G.activeHole) llInfo += '<div class="modal-ll-info ll-info-hole"><i class="fas fa-bomb"></i> ÿßŸÑÿ≠ŸÅÿ±ÿ© ‚Äî ÿßŸÑŸÜŸÇÿßÿ∑ ÿ™ŸèÿÆÿµŸÖ ŸÖŸÜ ÿßŸÑÿÆÿµŸÖ</div>';
    if (G.activeDouble) llInfo += '<div class="modal-ll-info ll-info-double"><i class="fas fa-clone"></i> ÿ¨ÿßŸàÿ® ÿ¨Ÿàÿßÿ®ŸäŸÜ ‚Äî ŸÅÿ±ÿµÿ™ÿßŸÜ</div>';
    if (G.activeCall) llInfo += '<div class="modal-ll-info ll-info-call"><i class="fas fa-phone"></i> ÿßÿ™ÿµÿßŸÑ ÿ®ÿµÿØŸäŸÇ ‚Äî ŸàŸÇÿ™ ÿ•ÿ∂ÿßŸÅŸä</div>';
    if (G.activeRest) llInfo += `<div class="modal-ll-info ll-info-rest"><i class="fas fa-couch"></i> ÿßÿ≥ÿ™ÿ±Ÿäÿ≠ ‚Äî ŸÑÿßÿπÿ® ${G.teams[G.restTarget].name} ÿßŸÑŸÖŸÖŸäÿ≤ Ÿäÿ≥ÿ™ÿ±Ÿäÿ≠</div>`;

    $('qModalBox').innerHTML = `
      <button class="modal-close" onclick="App.forceClose()"><i class="fas fa-times"></i></button>
      <div style="margin-bottom:12px">
        <span class="modal-cat">${cat.icon} ${cat.name}</span>
        <span class="modal-pts-badge">${toAr(pts)} ŸÜŸÇÿ∑ÿ©</span>
      </div>
      ${llInfo}
      <div class="modal-q">${q.q}</div>
      <div class="modal-timer">
        <div class="mt-num" id="mtNum">${toAr(totalTime)}</div>
        <div class="mt-bar"><div class="mt-fill" id="mtFill" style="width:100%"></div></div>
      </div>
      <div class="modal-opts" id="mOpts">
        ${q.opts.map((o, i) => `
          <button class="mo-btn" data-i="${i}" onclick="App.answer(${i})">
            <span class="mo-lbl">${LABELS[i]}</span> ${o}
          </button>`).join('')}
      </div>
      <div class="modal-feedback" id="mFeedback"></div>`;

    openModal();

    startTimer(totalTime,
      (v, total) => {
        const numEl = $('mtNum');
        const fillEl = $('mtFill');
        if (!numEl) return;
        numEl.textContent = toAr(v);
        fillEl.style.width = (v / total * 100) + '%';
        if (v <= 5) { numEl.classList.add('warn'); fillEl.classList.add('warn'); }
      },
      () => this._timeout()
    );
  },

  answer(idx) {
    if (G.locked) return;
    const q = G.currentQ;
    const correct = idx === q.ans;
    const btns = document.querySelectorAll('#mOpts .mo-btn');
    const clicked = btns[idx];

    if (correct) {
      G.locked = true;
      stopTimer();
      clicked.classList.add('correct');
      btns.forEach(b => b.disabled = true);

      if (G.activeHole) {
        const opp = (G.turn + 1) % G.numTeams;
        G.teams[opp].score = Math.max(0, G.teams[opp].score - G.currentPts);
        $('mFeedback').className = 'modal-feedback ok';
        $('mFeedback').innerHTML = `<i class="fas fa-bomb"></i> ÿµÿ≠Ÿäÿ≠! ÿÆŸèÿµŸÖÿ™ ${toAr(G.currentPts)} ŸÜŸÇÿ∑ÿ© ŸÖŸÜ ${G.teams[opp].name}`;
      } else {
        G.teams[G.turn].score += G.currentPts;
        $('mFeedback').className = 'modal-feedback ok';
        $('mFeedback').innerHTML = `<i class="fas fa-check-circle"></i> ÿµÿ≠Ÿäÿ≠! +${toAr(G.currentPts)} ŸÜŸÇÿ∑ÿ©`;
      }

      this._updateTopBar();
      this._clearLL();
      // Wait ANSWER_SHOW_DELAY before closing
      setTimeout(() => this._afterAnswer(), ANSWER_SHOW_DELAY);

    } else {
      clicked.classList.add('wrong');
      clicked.disabled = true;

      // Double-dip: first wrong gets a second chance
      if (G.activeDouble && !G.doubleUsed) {
        G.doubleUsed = true;
        $('mFeedback').className = 'modal-feedback fail';
        $('mFeedback').textContent = 'ÿÆÿ∑ÿ£! ŸÑÿØŸäŸÉ ŸÅÿ±ÿµÿ© ÿ´ÿßŸÜŸäÿ©...';
        return; // Don't lock ‚Äî allow another pick
      }

      // Fully wrong
      G.locked = true;
      stopTimer();
      btns.forEach(b => b.disabled = true);
      // Reveal correct in green
      if (btns[q.ans]) btns[q.ans].classList.add('reveal');
      $('mFeedback').className = 'modal-feedback fail';
      $('mFeedback').innerHTML = '<i class="fas fa-times-circle"></i> ÿ•ÿ¨ÿßÿ®ÿ© ÿÆÿßÿ∑ÿ¶ÿ©!';
      this._clearLL();
      setTimeout(() => this._afterAnswer(), ANSWER_SHOW_DELAY);
    }
  },

  _timeout() {
    if (G.locked) return;
    G.locked = true;
    const q = G.currentQ;
    const btns = document.querySelectorAll('#mOpts .mo-btn');
    btns.forEach(b => b.disabled = true);
    if (btns[q.ans]) btns[q.ans].classList.add('reveal');
    $('mFeedback').className = 'modal-feedback fail';
    $('mFeedback').innerHTML = '<i class="fas fa-clock"></i> ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸàŸÇÿ™!';
    this._clearLL();
    setTimeout(() => this._afterAnswer(), ANSWER_SHOW_DELAY);
  },

  _clearLL() {
    G.activeHole = false;
    G.activeDouble = false;
    G.activeCall = false;
    G.activeRest = false;
    G.restTarget = -1;
    G.doubleUsed = false;
  },

  _afterAnswer() {
    closeModal();
    G.boardUsed.add(G.currentCell);
    G.answeredCount++;
    G.turn = (G.turn + 1) % G.numTeams;

    this._renderBoard();
    this._renderLifelines();

    // Check game over
    if (G.answeredCount >= G.totalCells) {
      setTimeout(() => this._endGame(), 400);
    }
  },

  forceClose() {
    if (!G.locked) return;
    closeModal();
  },

  /* ---- Game Over ---- */
  _endGame() {
    showScreen('resultScreen');

    // Sort teams by score descending
    const sorted = [...G.teams].sort((a, b) => b.score - a.score);
    const maxScore = sorted[0].score;
    const winners = sorted.filter(t => t.score === maxScore);
    const tie = winners.length > 1;

    let html = '<div class="game-over-label">ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÑÿπÿ®ÿ©</div>';

    if (tie) {
      html += `
        <div class="tie-icon">ü§ù</div>
        <div class="tie-text">ÿ™ÿπÿßÿØŸÑ!</div>
        <div class="res-sub">ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ŸÖÿ™ÿ≥ÿßŸàŸäÿ© ÿ®ŸäŸÜ ${winners.map(w => w.name).join(' Ÿà ')}</div>`;
    } else {
      html += `
        <div class="trophy">üèÜ</div>
        <div class="res-winner">${winners[0].name}</div>
        <div class="res-sub">ÿßŸÑŸÅÿßÿ¶ÿ≤ ÿ®ŸÖÿ≥ÿßÿ®ŸÇÿ© ÿØÿ±ÿ¨ÿßÿ™ ŸàÿØÿ±ŸÉÿßÿ™!</div>`;
      setTimeout(spawnConfetti, 200);
      setTimeout(spawnConfetti, 1500);
    }

    // Ranked scores
    html += '<div class="res-scores">';
    sorted.forEach((t, i) => {
      const isWin = !tie && t === winners[0];
      const rank = i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : `#${i+1}`;
      html += `<div class="res-team ${isWin ? 'win' : ''}">
        <div class="rt-rank">${rank}</div>
        <div class="rt-name">${t.name}</div>
        <div class="rt-score">${toAr(t.score)}</div>
      </div>`;
    });
    html += '</div>';

    html += `<div class="res-actions">
      <button class="btn btn-accent btn-lg" onclick="App.playAgain()"><i class="fas fa-redo"></i> ÿßŸÑÿπÿ® ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ</button>
      <button class="btn btn-secondary btn-lg" onclick="App.home()"><i class="fas fa-home"></i> ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</button>
    </div>`;

    $('resultBox').innerHTML = html;
  },

  playAgain() {
    // Keep team names, restart everything else
    const names = G.teams.map(t => t.name);
    const n = G.numTeams;
    const nc = G.numCats;
    resetG();
    G.numTeams = n;
    G.numCats = nc;
    for (let i = 0; i < n; i++) {
      G.teams.push({ name: names[i], score: 0, color: TEAM_COLORS[i % TEAM_COLORS.length] });
      G.lifelines.push({ call: true, double: true, hole: true, rest: true });
      G.teamPicks.push([]);
    }
    G.pickTurn = 0;
    // Reload categories
    G.allCategories = buildCategories(G.rawCache || FALLBACK_RAW);
    $('catHeaderSub').textContent = `ŸÉŸÑ ŸÅÿ±ŸäŸÇ ŸäÿÆÿ™ÿßÿ± ŸÅÿ¶ÿßÿ™Ÿá ‚Äî ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ${toAr(nc)} ŸÅÿ¶ÿßÿ™`;
    showScreen('catScreen');
    this._renderCatSelection();
  },

  home() {
    resetG();
    showScreen('welcomeScreen');
    App.buildTeamInputs();
  }
};

/* ============================================
   KEYBOARD
   ============================================ */
document.addEventListener('keydown', e => {
  if (G.locked) return;
  const map = {'1':0,'2':1,'3':2,'4':3};
  if (map[e.key] !== undefined && $('qModal').classList.contains('show')) {
    const btn = document.querySelector(`#mOpts .mo-btn[data-i="${map[e.key]}"]`);
    if (btn && !btn.disabled) btn.click();
  }
});

/* ============================================
   INIT
   ============================================ */
App.buildTeamInputs();
</script>
</body>
</html>
